<!DOCTYPE html>
<html>
<head>
    <title>Debug Agenda</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Debug Agenda - Supabase</h1>
    <div id="results"></div>
    
    <script>
        const supabaseUrl = 'https://odwouhhxvlkpkjklwoxo.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9kd291aGh4dmxrcGtqa2x3b3hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4Mjc2ODEsImV4cCI6MjA2OTQwMzY4MX0.e7RR0PHzyWlrQ3Ci9V9ZCLrPKmtIO0PMef0ue3yBce8'
        
        const { createClient } = supabase
        const client = createClient(supabaseUrl, supabaseKey)
        
        async function debugAgenda() {
            const results = document.getElementById('results')
            
            try {
                // 1. Verificar todos os agendamentos
                console.log('=== VERIFICANDO TODOS OS AGENDAMENTOS ===')
                const { data: allAgenda, error: allError } = await client
                    .from('agenda')
                    .select('*')
                    .order('created_at', { ascending: false })
                
                if (allError) throw allError
                
                results.innerHTML += `<h2>Todos os Agendamentos (${allAgenda.length})</h2>`
                results.innerHTML += `<pre>${JSON.stringify(allAgenda, null, 2)}</pre>`
                
                // 2. Verificar agendamentos de hoje
                const hoje = new Date().toISOString().split('T')[0]
                console.log('=== VERIFICANDO AGENDAMENTOS DE HOJE ===', hoje)
                
                const { data: hoje_agenda, error: hojeError } = await client
                    .from('agenda')
                    .select('*')
                    .eq('data', hoje)
                
                if (hojeError) throw hojeError
                
                results.innerHTML += `<h2>Agendamentos de Hoje (${hoje}) - ${hoje_agenda.length}</h2>`
                results.innerHTML += `<pre>${JSON.stringify(hoje_agenda, null, 2)}</pre>`
                
                // 3. Verificar agendamentos de amanhã
                const amanha = new Date()
                amanha.setDate(amanha.getDate() + 1)
                const amanhaStr = amanha.toISOString().split('T')[0]
                
                console.log('=== VERIFICANDO AGENDAMENTOS DE AMANHÃ ===', amanhaStr)
                
                const { data: amanha_agenda, error: amanhaError } = await client
                    .from('agenda')
                    .select('*')
                    .eq('data', amanhaStr)
                
                if (amanhaError) throw amanhaError
                
                results.innerHTML += `<h2>Agendamentos de Amanhã (${amanhaStr}) - ${amanha_agenda.length}</h2>`
                results.innerHTML += `<pre>${JSON.stringify(amanha_agenda, null, 2)}</pre>`
                
                // 4. Criar um agendamento de teste para amanhã
                console.log('=== CRIANDO AGENDAMENTO DE TESTE ===')
                
                const { data: novoAgendamento, error: createError } = await client
                    .from('agenda')
                    .insert([{
                        horario: '14:30',
                        funcionario_id: 'michelle',
                        tarefa_id: 'checkins',
                        data: amanhaStr
                    }])
                    .select()
                
                if (createError) throw createError
                
                results.innerHTML += `<h2>Agendamento Criado</h2>`
                results.innerHTML += `<pre>${JSON.stringify(novoAgendamento, null, 2)}</pre>`
                
            } catch (error) {
                console.error('Erro:', error)
                results.innerHTML += `<h2>ERRO</h2><pre>${JSON.stringify(error, null, 2)}</pre>`
            }
        }
        
        // Executar quando a página carregar
        window.onload = debugAgenda
    </script>
</body>
</html>